<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.web.mapper.TrackingBoardMapper">

	
	<select id="selectPriceHistory" resultType="priceHistoryVO">
<!-- 		select * from tbl_price_history -->
<!-- 		where pNo = #{pNo} -->

		select *
		from
		tbl_price_history
		where pNo = #{pNo}
        and (currDate like concat('%',' 15:','%') 
        or currDate like concat('%',' 16:','%'))  
        order by currDate  
	</select>

	<select id="selectBoardCorrect" resultType="TrackingBoardVO">
		select p.*, t.notifyPrice, t.email
		from tbl_product p 
		inner join tbl_tracking t
		on p.pNo = t.pNo 
        where t.email = #{email} and t.notifyPrice >= p.pLowest
		order by pNo desc 
	
	</select>
	
	<select id="selectBoardInCorrect" resultType="TrackingBoardVO">
		select p.*, t.notifyPrice, t.email
		from tbl_product p 
		inner join tbl_tracking t
		on p.pNo = t.pNo 
        where t.email = #{email} and p.pLowest > t.notifyPrice
		order by pNo desc 
		limit 0, 10;
	</select>

	<select id="infiniteScrollDown" resultType="TrackingBoardVO">
	<![CDATA[
		select p.*, t.notifyPrice, t.email
		from tbl_product p 
		inner join tbl_tracking t
		on p.pNo = t.pNo 
        where t.email = #{email} and p.pLowest > t.notifyPrice
		order by pNo desc 
		limit #{begin}, 10;
	]]>
	</select>

	<select id="priceList" resultType="int">
		select currPrice
		from
		tbl_price_history
		where pNo = #{pNo}
	</select>

	<update id="priceUpdate">
		update tbl_tracking
		set notifyPrice = #{notifyPrice}
		where pNo = #{pNo}
	</update>

	<delete id="delete" >
		delete from tbl_product
		where pNo = #{pNo}
	</delete>


</mapper>